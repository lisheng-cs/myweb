import{s as pe}from"./element-china-area-data-CYTyhV3z.js";import{d as me,m as R,r as c,o as ce,U as A,E as g,n as G,B as ge,c as w,a,w as o,b as s,f as y,i,h as fe,g as P,j as _e,k as ve,t as b,F as be,l as ye,p as he,u as Ve,_ as Re}from"./index-DqaPb8Ym.js";import{F as we}from"./FileControllerService-xQF0at9C.js";const Pe={class:"user-management-container"},Ue={class:"pagination-container"},Ce={class:"avatar-upload"},Ne={key:0,class:"selected-region"},ke=me({__name:"UserList",setup(ze){const f=R({userName:""}),U=c([]),h=c(!1),d=R({current:1,pageSize:10,total:0}),x={0:"女",1:"男"},L={admin:"管理员",user:"普通用户"},T=[{value:"user",label:"普通用户"},{value:"admin",label:"管理员"}];ce(()=>{_()});const _=async()=>{try{h.value=!0;const l={current:d.current,pageSize:d.pageSize,userName:f.userName},e=await A.listUserByPageUsingPost(l);e.code===0&&e.data&&(U.value=e.data.records||[],d.total=parseInt(e.data.total)||0)}catch{g.error("数据加载失败")}finally{h.value=!1}},C=()=>{d.current=1,_()},M=()=>{f.userName="",C()},j=l=>{d.pageSize=l,_()},I=l=>{d.current=l,_()},$=l=>{switch(l){case"admin":return"danger";case"editor":return"warning";default:return"info"}},v=c(!1),V=c(!1),N=c(),k=c(),r=R({id:0,userName:"",userEmail:"",userPhone:"",userGender:0,userBirthday:"",userRole:"user",userRegion:"",userProfile:"",userAvatar:""}),q={userName:[{required:!0,message:"请输入用户名",trigger:"blur"}],userEmail:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:["blur","change"]}],userRole:[{required:!0,message:"请选择用户角色",trigger:"change"}],userRegion:[{validator:(l,e,n)=>{!e||e.split(" ").length!==3?n(new Error("请选择完整的省/市/区")):n()},trigger:"change"}]},O=pe,Y={value:"label",children:"children"},z=G({get:()=>r.userRegion?r.userRegion.split(" "):[],set:l=>{r.userRegion=l.length===3?l.join(" "):""}}),E=c(),H=G(()=>r.userAvatar?ge+r.userAvatar:"/default-avatar.png"),J=()=>{var l;(l=E.value)==null||l.click()},K=async l=>{var u;const e=l.target;if(!((u=e.files)!=null&&u.length))return;const n=e.files[0];r.userAvatar=URL.createObjectURL(n);try{const m=await we.uploadFileUsingPost(n,"user_avatar");r.userAvatar=m.data,g.success("头像上传成功")}catch{g.error("头像上传失败")}},Q=l=>{N.value=l,Object.assign(r,{id:l.id,userName:l.userName||"",userEmail:l.userEmail||"",userPhone:l.userPhone||"",userGender:l.userGender||0,userBirthday:l.userBirthday||"",userRole:l.userRole||"user",userRegion:l.userRegion||"",userProfile:l.userProfile||"",userAvatar:l.userAvatar||""}),v.value=!0},W=async()=>{try{if(!await k.value.validate())return;V.value=!0;const e={id:r.id,userName:r.userName,userEmail:r.userEmail,userPhone:r.userPhone,userGender:r.userGender,userBirthday:r.userBirthday,userRole:r.userRole,userRegion:r.userRegion,userProfile:r.userProfile,userAvatar:r.userAvatar},n=await A.updateUserUsingPost(e);n.code===0?(g.success("用户信息更新成功"),v.value=!1,_()):g.error(n.message||"更新失败")}catch{g.error("网络或服务器错误")}finally{V.value=!1}},X=l=>{if(!l)return"-";try{return new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-")}catch{return"-"}},Z=l=>{if(!l)return"-";try{const e=new Date(l),n=e.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),u=e.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"});return`${n} ${u}`}catch{return"-"}};return(l,e)=>{var F;const n=s("el-input"),u=s("el-form-item"),m=s("el-button"),S=s("el-form"),B=s("el-card"),p=s("el-table-column"),ee=s("el-tag"),ae=s("el-table"),te=s("el-pagination"),le=s("el-avatar"),re=s("el-date-picker"),D=s("el-radio"),oe=s("el-radio-group"),se=s("el-option"),ne=s("el-select"),ue=s("el-cascader"),ie=s("el-dialog"),de=_e("loading");return y(),w("div",Pe,[a(B,{class:"search-card"},{default:o(()=>[a(S,{inline:!0,model:f},{default:o(()=>[a(u,{label:"用户名"},{default:o(()=>[a(n,{modelValue:f.userName,"onUpdate:modelValue":e[0]||(e[0]=t=>f.userName=t),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),a(u,null,{default:o(()=>[a(m,{type:"primary",onClick:C},{default:o(()=>e[13]||(e[13]=[i("搜索")])),_:1}),a(m,{onClick:M},{default:o(()=>e[14]||(e[14]=[i("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(B,{class:"table-card"},{default:o(()=>[fe((y(),ve(ae,{data:U.value,border:"",style:{width:"100%"}},{default:o(()=>[a(p,{prop:"id",label:"ID",width:"80"}),a(p,{prop:"userName",label:"用户名",width:"150"}),a(p,{prop:"userRole",label:"角色",width:"120"},{default:o(({row:t})=>[a(ee,{type:$(t.userRole)},{default:o(()=>[i(b(L[t.userRole]||t.userRole),1)]),_:2},1032,["type"])]),_:1}),a(p,{prop:"userEmail",label:"邮箱",width:"200"}),a(p,{prop:"userPhone",label:"电话",width:"150"}),a(p,{prop:"userGender",label:"性别",width:"100"},{default:o(({row:t})=>[i(b(x[t.userGender]||"未知"),1)]),_:1}),a(p,{prop:"userBirthday",label:"生日",width:"120"},{default:o(({row:t})=>[i(b(X(t.userBirthday)),1)]),_:1}),a(p,{prop:"createTime",label:"创建时间",width:"180"},{default:o(({row:t})=>[i(b(Z(t.createTime)),1)]),_:1}),e[16]||(e[16]=i("/ ")),a(p,{label:"操作",fixed:"right",width:"120"},{default:o(({row:t})=>[a(m,{type:"primary",size:"small",onClick:Ee=>Q(t)},{default:o(()=>e[15]||(e[15]=[i(" 修改 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,h.value]]),P("div",Ue,[a(te,{"current-page":d.current,"onUpdate:currentPage":e[1]||(e[1]=t=>d.current=t),"page-size":d.pageSize,"onUpdate:pageSize":e[2]||(e[2]=t=>d.pageSize=t),"page-sizes":[5,10,20,30,40],total:d.total,background:l.background,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:I},null,8,["current-page","page-size","total","background"])])]),_:1}),a(ie,{modelValue:v.value,"onUpdate:modelValue":e[12]||(e[12]=t=>v.value=t),title:`编辑用户 - ${(F=N.value)==null?void 0:F.userName}`,width:"600px"},{footer:o(()=>[a(m,{onClick:e[11]||(e[11]=t=>v.value=!1)},{default:o(()=>e[20]||(e[20]=[i("取消")])),_:1}),a(m,{type:"primary",loading:V.value,onClick:W},{default:o(()=>e[21]||(e[21]=[i(" 保存 ")])),_:1},8,["loading"])]),default:o(()=>[a(S,{model:r,rules:q,ref_key:"editFormRef",ref:k,"label-width":"100px"},{default:o(()=>[a(u,{label:"头像"},{default:o(()=>[P("div",Ce,[a(le,{src:H.value,size:"large"},null,8,["src"]),a(m,{size:"small",onClick:J},{default:o(()=>e[17]||(e[17]=[i("更换头像")])),_:1}),P("input",{ref_key:"editFileInput",ref:E,type:"file",accept:"image/*",class:"hidden-file-input",onChange:K},null,544)])]),_:1}),a(u,{label:"用户名",prop:"userName"},{default:o(()=>[a(n,{modelValue:r.userName,"onUpdate:modelValue":e[3]||(e[3]=t=>r.userName=t)},null,8,["modelValue"])]),_:1}),a(u,{label:"邮箱",prop:"userEmail"},{default:o(()=>[a(n,{modelValue:r.userEmail,"onUpdate:modelValue":e[4]||(e[4]=t=>r.userEmail=t)},null,8,["modelValue"])]),_:1}),a(u,{label:"电话",prop:"userPhone"},{default:o(()=>[a(n,{modelValue:r.userPhone,"onUpdate:modelValue":e[5]||(e[5]=t=>r.userPhone=t)},null,8,["modelValue"])]),_:1}),a(u,{label:"生日",prop:"userBirthday"},{default:o(()=>[a(re,{modelValue:r.userBirthday,"onUpdate:modelValue":e[6]||(e[6]=t=>r.userBirthday=t),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(u,{label:"性别",prop:"userGender"},{default:o(()=>[a(oe,{modelValue:r.userGender,"onUpdate:modelValue":e[7]||(e[7]=t=>r.userGender=t)},{default:o(()=>[a(D,{value:0},{default:o(()=>e[18]||(e[18]=[i("女")])),_:1}),a(D,{value:1},{default:o(()=>e[19]||(e[19]=[i("男")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"用户角色",prop:"userRole"},{default:o(()=>[a(ne,{modelValue:r.userRole,"onUpdate:modelValue":e[8]||(e[8]=t=>r.userRole=t),placeholder:"请选择角色"},{default:o(()=>[(y(),w(be,null,ye(T,t=>a(se,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"地区",prop:"userRegion"},{default:o(()=>[a(ue,{modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=t=>z.value=t),options:Ve(O),props:Y,placeholder:"请选择省/市/区",clearable:"",filterable:"",style:{width:"100%"}},null,8,["modelValue","options"]),r.userRegion?(y(),w("div",Ne," 当前地区："+b(r.userRegion),1)):he("",!0)]),_:1}),a(u,{label:"简介",prop:"userProfile"},{default:o(()=>[a(n,{type:"textarea",modelValue:r.userProfile,"onUpdate:modelValue":e[10]||(e[10]=t=>r.userProfile=t),rows:3,placeholder:"个人简介"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Fe=Re(ke,[["__scopeId","data-v-2abfb391"]]);export{Fe as default};
