import{d as X,r as f,m as k,n as Y,o as Z,c as A,a,w as t,b as s,E as _,f as u,i as c,h as ee,g as ae,j as te,k as C,u as z,B as P,F as le,s as oe,v as se,_ as re}from"./index-DqaPb8Ym.js";import{A as N}from"./ActorControllerService-Dt0n4IfZ.js";import{F as ne}from"./FileControllerService-xQF0at9C.js";const ue={class:"actor-management"},ie={key:1},de={class:"pagination-container"},ce=["src"],me=X({__name:"Actor",setup(pe){const V=f([]),w=f(!1),v=k({userName:""}),n=k({current:1,pageSize:10,total:0}),m=f(!1),o=k({userName:"",userAvatar:""}),x=f(),g=f(!1),D=k({userName:[{required:!0,message:"请输入演员姓名",trigger:"blur"}]}),E=Y(()=>g.value?"编辑演员":"新增演员"),i=async()=>{try{w.value=!0;const l={current:n.current,pageSize:n.pageSize,userName:v.userName},e=await N.listActorByPageUsingPost(l);e.code===0&&e.data&&(V.value=e.data.records||[],n.total=parseInt(e.data.total)||0)}catch{_.error("数据加载失败")}finally{w.value=!1}},F=()=>{v.userName="",n.current=1,i()},j=()=>{g.value=!1,Object.assign(o,{userName:"",userAvatar:""}),m.value=!0},q=l=>{g.value=!0,Object.assign(o,l),m.value=!0},M=async l=>{try{await se.confirm("确认删除该演员吗？","提示",{type:"warning"}),(await N.deletePostUsingPost({id:l})).code===0&&(_.success("删除成功"),i())}catch{}},I=async()=>{try{if(await x.value.validate(),g.value){const l={id:o.id,userName:o.userName,userAvatar:o.userAvatar};await N.updateActorUsingPost(l)}else{const l={userName:o.userName,userAvatar:o.userAvatar};await N.addActorUsingPost(l)}_.success("操作成功"),m.value=!1,i()}catch(l){console.error("提交失败:",l)}},L=l=>{n.pageSize=l,i()},$=l=>{n.current=l,i()};Z(()=>{i()});const h=f(!1),O=async l=>{try{h.value=!0;const e=l.file,p=await ne.uploadFileUsingPost(e,"movie_actor");p.code===0&&p.data&&(o.userAvatar=p.data,_.success("上传成功"))}catch{_.error("上传失败")}finally{h.value=!1}};return(l,e)=>{const p=s("el-input"),y=s("el-form-item"),d=s("el-button"),S=s("el-form"),U=s("el-card"),b=s("el-table-column"),R=s("el-avatar"),T=s("el-table"),G=s("el-pagination"),H=s("Loading"),B=s("el-icon"),J=s("el-upload"),K=s("el-dialog"),Q=te("loading");return u(),A("div",ue,[a(U,{class:"search-card"},{default:t(()=>[a(S,{inline:!0},{default:t(()=>[a(y,{label:"演员姓名"},{default:t(()=>[a(p,{modelValue:v.userName,"onUpdate:modelValue":e[0]||(e[0]=r=>v.userName=r),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1}),a(y,null,{default:t(()=>[a(d,{type:"primary",onClick:i},{default:t(()=>e[4]||(e[4]=[c("搜索")])),_:1}),a(d,{onClick:F},{default:t(()=>e[5]||(e[5]=[c("重置")])),_:1}),a(d,{type:"success",onClick:j},{default:t(()=>e[6]||(e[6]=[c("新增演员")])),_:1})]),_:1})]),_:1})]),_:1}),a(U,{class:"table-card"},{default:t(()=>[ee((u(),C(T,{data:V.value,border:""},{default:t(()=>[a(b,{prop:"id",label:"ID",width:"80"}),a(b,{prop:"userName",label:"姓名",width:"150"}),a(b,{prop:"userAvatar",label:"头像",width:"120"},{default:t(({row:r})=>[r.userAvatar?(u(),C(R,{key:0,src:z(P)+r.userAvatar},null,8,["src"])):(u(),A("span",ie,"无头像"))]),_:1}),a(b,{label:"操作",width:"150",fixed:"right"},{default:t(({row:r})=>[a(d,{size:"small",onClick:W=>q(r)},{default:t(()=>e[7]||(e[7]=[c("编辑")])),_:2},1032,["onClick"]),a(d,{size:"small",type:"danger",onClick:W=>M(r.id)},{default:t(()=>e[8]||(e[8]=[c("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,w.value]]),ae("div",de,[a(G,{"current-page":n.current,"page-size":n.pageSize,total:n.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",background:"",onCurrentChange:$,onSizeChange:L},null,8,["current-page","page-size","total"])])]),_:1}),a(K,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=r=>m.value=r),title:E.value,width:"500px"},{footer:t(()=>[a(d,{onClick:e[2]||(e[2]=r=>m.value=!1)},{default:t(()=>e[9]||(e[9]=[c("取消")])),_:1}),a(d,{type:"primary",onClick:I},{default:t(()=>e[10]||(e[10]=[c("确认")])),_:1})]),default:t(()=>[a(S,{model:o,rules:D,ref_key:"formRef",ref:x,"label-width":"80px"},{default:t(()=>[a(y,{label:"姓名",prop:"userName"},{default:t(()=>[a(p,{modelValue:o.userName,"onUpdate:modelValue":e[1]||(e[1]=r=>o.userName=r),placeholder:"请输入演员姓名"},null,8,["modelValue"])]),_:1}),a(y,{label:"头像"},{default:t(()=>[a(J,{class:"avatar-uploader","show-file-list":!1,"auto-upload":!0,"http-request":O},{default:t(()=>[h.value?(u(),C(B,{key:0,class:"is-loading"},{default:t(()=>[a(H)]),_:1})):(u(),A(le,{key:1},[o.userAvatar?(u(),A("img",{key:0,src:z(P)+o.userAvatar,class:"avatar"},null,8,ce)):(u(),C(B,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[a(z(oe))]),_:1}))],64))]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),ge=re(me,[["__scopeId","data-v-063a3811"]]);export{ge as default};
