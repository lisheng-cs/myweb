import{d as G,y as I,m as j,r as g,n as U,B as z,k as L,w as a,b as n,f as h,g as _,a as l,i as m,c as M,p as O,u as D,t as T,E as p,U as H,_ as J}from"./index-h4lH79Q9.js";import{s as K}from"./element-china-area-data-CYTyhV3z.js";import{F as Q}from"./FileControllerService-DqaFuhN1.js";const W={class:"avatar-upload"},X={key:0,class:"selected-region"},Y=G({__name:"Profile",setup(Z){var b;const c=I(),e=j({...c.user,userRegion:((b=c.user)==null?void 0:b.userRegion)||""}),R={userName:[{required:!0,message:"请输入昵称",trigger:"blur"}],userEmail:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:["blur","change"]}],userPhone:[{required:!0,message:"请输入电话",trigger:"blur"}],userBirthday:[{required:!0,message:"请选择生日",trigger:"change"}],userGender:[{required:!0,message:"请选择性别",trigger:"change"}],userRegion:[{validator:(s,r,t)=>{!r||r.split(" ").length!==3?t(new Error("请选择完整的省/市/区")):t()},trigger:"change"}]},v=g();function B(){var s;(s=v.value)==null||s.click()}async function k(s){var d;const r=s.target;if(!((d=r.files)!=null&&d.length))return;const t=r.files[0];e.userAvatar=URL.createObjectURL(t);try{const i=(await Q.uploadFileUsingPost(t,"user_avatar")).data;e.userAvatar=i,p.success("头像上传成功")}catch{p.error("头像上传失败")}}const w=U(()=>e.userAvatar?z+e.userAvatar:"/default-avatar.png"),C=K,E={value:"label",children:"children"},y=U({get:()=>e.userRegion?e.userRegion.split(" "):[],set:s=>{e.userRegion=s.length===3?s.join(" "):""}}),V=g(),f=g(!1);async function N(){if(!await V.value.validate().catch(()=>!1))return;f.value=!0;const r={id:e.id,userName:e.userName,userEmail:e.userEmail,userPhone:e.userPhone,userBirthday:e.userBirthday,userGender:e.userGender,userRegion:e.userRegion,userProfile:e.userProfile,userAvatar:e.userAvatar};try{const t=await H.updateMyUserUsingPost(r);t.code===0?(p.success("更新成功"),c.user={...e}):p.error(t.message||"更新失败")}catch{p.error("网络或服务器错误")}finally{f.value=!1}}return(s,r)=>{const t=n("el-avatar"),d=n("el-button"),u=n("el-form-item"),i=n("el-input"),S=n("el-date-picker"),P=n("el-radio"),x=n("el-radio-group"),A=n("el-cascader"),F=n("el-form"),q=n("el-card");return h(),L(q,{class:"profile-card"},{default:a(()=>[r[11]||(r[11]=_("h2",null,"个人资料",-1)),l(F,{model:e,rules:R,ref_key:"profileForm",ref:V,"label-width":"100px",class:"profile-form"},{default:a(()=>[l(u,{label:"头像"},{default:a(()=>[_("div",W,[l(t,{src:w.value,size:"large"},null,8,["src"]),l(d,{size:"small",onClick:B},{default:a(()=>r[7]||(r[7]=[m("更换头像")])),_:1}),_("input",{ref_key:"fileInput",ref:v,type:"file",accept:"image/*",class:"hidden-file-input",onChange:k},null,544)])]),_:1}),l(u,{label:"昵称",prop:"userName"},{default:a(()=>[l(i,{modelValue:e.userName,"onUpdate:modelValue":r[0]||(r[0]=o=>e.userName=o)},null,8,["modelValue"])]),_:1}),l(u,{label:"邮箱",prop:"userEmail"},{default:a(()=>[l(i,{modelValue:e.userEmail,"onUpdate:modelValue":r[1]||(r[1]=o=>e.userEmail=o)},null,8,["modelValue"])]),_:1}),l(u,{label:"电话",prop:"userPhone"},{default:a(()=>[l(i,{modelValue:e.userPhone,"onUpdate:modelValue":r[2]||(r[2]=o=>e.userPhone=o)},null,8,["modelValue"])]),_:1}),l(u,{label:"生日",prop:"userBirthday"},{default:a(()=>[l(S,{modelValue:e.userBirthday,"onUpdate:modelValue":r[3]||(r[3]=o=>e.userBirthday=o),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(u,{label:"性别",prop:"userGender"},{default:a(()=>[l(x,{modelValue:e.userGender,"onUpdate:modelValue":r[4]||(r[4]=o=>e.userGender=o)},{default:a(()=>[l(P,{value:0},{default:a(()=>r[8]||(r[8]=[m("女")])),_:1}),l(P,{value:1},{default:a(()=>r[9]||(r[9]=[m("男")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"地区",prop:"userRegion"},{default:a(()=>[l(A,{modelValue:y.value,"onUpdate:modelValue":r[5]||(r[5]=o=>y.value=o),options:D(C),props:E,placeholder:"请选择省/市/区",clearable:"",filterable:"",style:{width:"100%"}},null,8,["modelValue","options"]),e.userRegion?(h(),M("div",X," 当前地区："+T(e.userRegion),1)):O("",!0)]),_:1}),l(u,{label:"简介",prop:"userProfile"},{default:a(()=>[l(i,{type:"textarea",modelValue:e.userProfile,"onUpdate:modelValue":r[6]||(r[6]=o=>e.userProfile=o),rows:3,placeholder:"个人简介"},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(d,{type:"primary",loading:f.value,onClick:N},{default:a(()=>r[10]||(r[10]=[m(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})}}}),le=J(Y,[["__scopeId","data-v-6893585c"]]);export{le as default};
